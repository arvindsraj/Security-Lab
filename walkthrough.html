<html><head><title>Cybersecurity Lab</title><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=pYEwJuzr3ZMDX2Y1syVbvyys90xk6yC7BGUgJrNTTF0');ol{margin:0;padding:0}.c8{color:#666666;font-size:10pt;background-color:#00ff00}.c11{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c5{font-size:30pt;font-family:"Consolas"}.c2{color:#999999;font-family:"Ubuntu"}.c7{color:#1155cc;text-decoration:underline}.c1{color:inherit;text-decoration:inherit}.c10{color:#ff0000}.c0{direction:ltr}.c3{font-weight:bold}.c9{text-align:center}.c6{font-family:"Consolas"}.c4{height:11pt}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;background-color:#00ff00;font-family:"Consolas";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#999999;font-style:italic;font-size:10pt;font-family:"Ubuntu";padding-bottom:2pt}</style></head><body class="c11"><p class="c0 c9 title"><a name="h.d024v6f1968t"></a><span class="c5">Recon &amp; Exploit With W3AF</span></p><h3 class="c0 c9"><a name="h.d3796dyf3n28"></a><span>A primer on W3AF, SQLi, XSS and more!</span></h3><h6 class="c0 c9"><a name="h.mnceho29al7x"></a><span>[bduong, crowell, richtia, samahmed, soptnrs]@bu.edu</span></h6><p class="c0 subtitle"><a name="h.cbiq0gm0f8g9"></a><span>Warning!</span></p><p class="c0"><span>Never ever point W3AF, sqlmap, or similar tools at databases which you do not have explicit permissions to do so. &nbsp;These tools can cause a lot of damage! &nbsp;You </span><span class="c3">can </span><span>be backtraced, and the cyber police</span><span class="c3">&nbsp;will</span><span>&nbsp;find you!</span></p><p class="c0 subtitle"><a name="h.1q2762xqgs5w"></a><span>Key Terms: </span></p><p class="c0"><span class="c3">W3AF </span><span>- Web Application Audit and Attack Framework (</span><span class="c7"><a class="c1" href="http://w3af.sourceforge.net/">http://w3af.sourceforge.net/</a></span><span>), the main tool to be used in this lab</span></p><p class="c0"><span class="c3">SQLi </span><span>- SQL Injection. &nbsp;The process of &ldquo;injecting&rdquo; your own queries into SQL queries done by the page. &nbsp;See OWASP&rsquo;s page for more detailed information! (</span><span class="c7"><a class="c1" href="https://www.owasp.org/index.php/SQL_Injection">https://www.owasp.org/index.php/SQL_Injection</a></span><span>)</span></p><p class="c0"><span class="c3">XSS </span><span>- Cross Site Scripting, another injection vulnerability, the process of injecting your own own javascript code into the DOM of a HTML document. See OWASP&rsquo;s page for more details. (</span><span class="c7"><a class="c1" href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)">https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)</a></span><span>)</span></p><p class="c0 subtitle"><a name="h.uwudl3ecbnrg"></a><span>Style of this lab</span></p><p class="c0"><span>Commands to put into your shell (your local shell) will look like this </span></p><h5 class="c0"><a name="h.tsgwyz7xi54v"></a><span>vim leethax.cpp </span></h5><p class="c0"><span>As at the time of the lab it is unknown where the website will be able to be hosted, we&rsquo;ll assume the host of the site is </span></p><p class="c0"><span class="c7"><a class="c1" href="http://vulnerable/">http://vulnerable/</a></span><span>&nbsp;</span></p><p class="c0"><span>We&rsquo;ll assume that you&rsquo;re using the backtrack VM in the lab, and therefore are using firefox. &nbsp;The plugins referenced will be firefox plugins, there probably exist similar ones for Chrome, but please don&rsquo;t ever use IE or Safari.</span></p><p class="c0"><span>Comments and tips will be in this format, to let you know that there is more to research.</span></p><h6 class="c0"><a name="h.6nkqj6yt24gt"></a><span>Wow! Look at all those Bomb Flowers! Is there any way you can set them all off at once?</span></h6><p class="c0 subtitle"><a name="h.ic829jwsifgf"></a><span>Getting Started - Mapping the Site</span></p><p class="c0"><span>First things first, in finding vulnerabilities in web applications, you must know where to look. &nbsp;W3AF is a very powerful tool, but you don&rsquo;t know where to point it or or you wouldn&rsquo;t be taking this class! &nbsp;Good thing for us that W3AF contains a set of </span><span class="c3">discovery</span><span>&nbsp;plugins. &nbsp;Discovery plugins in W3AF are varied, some use Bing or Google spiders, which is great for live sites, and can find pages not linked from the root (but slow), and others spider the site themselves. &nbsp;Because the web application that we will be attacking today is not spidered by Bing or Google, we&rsquo;ll use the </span><span class="c3">webSpider</span><span>&nbsp;plugin. &nbsp;</span></p><p class="c0"><span>First, fire up W3AF, from your Backtrack Linux terminal</span></p><h5 class="c0"><a name="h.r91xcir1frek"></a><span>/pentest/web/w3af/w3af_gui</span></h5><p class="c0"><span>Point &ldquo;Target URL&rdquo; to </span><span class="c7"><a class="c1" href="http://vulnerable/,">http://vulnerable/</a></span><span class="c3">&nbsp;</span><span>and select from the </span><span class="c3">discovery</span><span>&nbsp;plugins, the </span><span class="c3">webSpider </span><span>plugin. &nbsp;Hit </span><span class="c3">Start</span><span>&nbsp;and let W3AF discover pages on the site. </span></p><p class="c0"><span>Go to </span><span class="c3">Results &gt; URLs </span><span>&nbsp;to see the map of the website that the </span><span class="c3">webSpider</span><span>&nbsp;made.</span><span class="c3">&nbsp;</span><span>&nbsp;Notice that page names, file names, and links between them are shown. &nbsp; Try visiting some of the pages found, login.php, members.php, register.php, and more! </span></p><h6 class="c0"><a name="h.ht2l5ipac3bg"></a><span>Sometimes there are pages that administrators don&rsquo;t want spiders to visit. &nbsp;They keep these in a &ldquo;robots.txt&rdquo; file. &nbsp;The plugin called </span><span class="c3">robotsReader</span><span>&nbsp;will crawl those pages! We will not need that plugin for this lab though.</span></h6><p class="c0"><span>This site looks very cool! Let&rsquo;s try to register! </span></p><p class="c0"><span>It didn&rsquo;t work, signups are closed? That&rsquo;s too bad, well, let&rsquo;s get in by force then.</span></p><p class="c0 subtitle"><a name="h.hthfy8502nsh"></a><span>Scanning For Vulns - Audit</span></p><p class="c0"><span>If all W3AF could do was spider and find all pages of a website, it wouldn&rsquo;t be of much use, would it? &nbsp;The framework contains plugins for all types of exploit discovery plugins, called </span><span class="c3">audit</span><span>&nbsp;plugins. &nbsp;We really want to get access to this site, and it uses PHP and some sort of database to manage login/password combinations. &nbsp;You could just select all of the </span><span class="c3">audit</span><span>&nbsp;plugins, but in this case, I&rsquo;ll be nice and tell you that we&rsquo;re looking for a </span><span class="c3">sqli</span><span>&nbsp;and </span><span class="c3">blind sqli</span><span>&nbsp;vulnerability. &nbsp;Blind sqli and sqli are the same thing, except with blind sqli, you can&rsquo;t tell what&rsquo;s going on! See OWASP&rsquo;s page on blind sqli for more help!</span></p><p class="c0"><span>Rerun the after adding </span><span class="c3">audit &gt; sqli</span><span>&nbsp;and </span><span class="c3">audit &gt; blindsqli </span><span>plugins to your list, point W3AF at </span><span class="c7"><a class="c1" href="http://vulnerable.">http://vulnerable</a></span><span><a class="c1" href="http://vulnerable.">&nbsp;again. &nbsp;This time watch the log for </a></span><span class="c10"><a class="c1" href="http://vulnerable.">RED</a></span><span><a class="c1" href="http://vulnerable.">&nbsp;text. &nbsp;This indicates a possible vulnerability that W3AF has spotted. &nbsp;In this case, the </a></span><span class="c3"><a class="c1" href="http://vulnerable.">login.php</a></span><span><a class="c1" href="http://vulnerable.">&nbsp;page seems to be vulnerable to SQL injection. &nbsp;The log will be nice enough to tell you what the request type and fields were used to discover the vulnerability. &nbsp;In this case the type is </a></span><span class="c3"><a class="c1" href="http://vulnerable.">POST</a></span><span><a class="c1" href="http://vulnerable.">&nbsp;and the field appears to be </a></span><span class="c3"><a class="c1" href="http://vulnerable.">username</a></span><span><a class="c1" href="http://vulnerable.">. You can use your browser or a web proxy to issue the same request to see what happens. &nbsp;It is easiest in this case to just replay the post with Firefox or curl.</a></span></p><h6 class="c0"><a name="h.lgjzu3fbagt4"></a><span>The two most popular web proxies are Fiddler2 and BURP Suite. &nbsp;I personally like fiddler, but it is for windows only, if you&rsquo;d like to try replaying the POST requests, you can try either. Burp should be built into your Backtrack VM.</span></h6><p class="c0"><span>Did you try replaying the query? Did it do anything? No? Well, it let you know that &ldquo;You have an error in your SQL syntax; check the manual &lt;snip&gt;&rdquo; That&rsquo;s helpful, but doesn&rsquo;t get you access...</span></p><p class="c0 subtitle"><a name="h.ibc5ocouj05g"></a><span>Exploiting the Database - Attack!</span></p><p class="c0"><span>So, W3AF said that it found some exploits, eh? That&rsquo;s good, but not only does it tell you that it found some exploits, but it can actually automatically perform them! Very cool, no? &nbsp;Go over to the </span><span class="c3">Exploit</span><span>&nbsp;tab to check out what it found. Looks like </span><span class="c3">sqlmap </span><span>and </span><span class="c3">sql_webshell </span><span>exploits were found. &nbsp;Which one should you use? &nbsp;Well, W3AF also happens to have the neat feature called </span><span class="c3">Exploit All Vulns</span><span>, which is the icon with the 3 gears on it. &nbsp;This will exploit everything that it found. &nbsp;Click that, and W3AF will go through and exploit everything. &nbsp;After a minute or so, you should notice an entry under the </span><span class="c3">Shells</span><span>&nbsp;pane. Double-click your shell to get access to the sql webshell. &nbsp; A new window with a command prompt should spawn. &nbsp;You can use this shell to interact with the database. &nbsp;Typing </span></p><h5 class="c0"><a name="h.67k9pc5xmcrt"></a><span class="c3">help</span><span>&nbsp;</span></h5><p class="c0"><span>will bring up your options</span></p><p class="c0"><span class="c6">fingerprint &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; perform an exaustive database fingerprint</span></p><p class="c0"><span class="c6">banner &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get database banner</span></p><p class="c0"><span class="c6">current-user &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get current database user</span></p><p class="c0"><span class="c6">current-db &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;get current database name</span></p><p class="c0"><span class="c6">users &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; get database users</span></p><p class="c0"><span class="c6">dbs &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; get available databases</span></p><p class="c0"><span class="c6">tables [db] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; get available databases tables (optional: database)</span></p><p class="c0"><span class="c6">columns &lt;table&gt; [db] &nbsp; &nbsp;get table columns (required: table optional: database)</span></p><p class="c0"><span class="c6">dump &lt;table&gt; [db] &nbsp; &nbsp; &nbsp; dump a database table (required: -T optional: -D)</span></p><p class="c0"><span class="c6">file &lt;FILENAME&gt; &nbsp; &nbsp; &nbsp; &nbsp; read a specific file content</span></p><p class="c0"><span class="c6">expression &lt;EXPRESSION&gt; expression to evaluate</span></p><p class="c0"><span class="c6">union-check &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; check for UNION sql injection</span></p><p class="c0"><span>The options we&rsquo;ll want to use are </span><span class="c3">dbs</span><span>, to find the names of the database, </span><span class="c3">tables [db]</span><span>, to find the tables within the database, and </span><span class="c3">dump &lt;table&gt; [db]</span><span>, to actually dump all of the information in the database. Once we&rsquo;ve dumped all of the information of the users on the database, we&rsquo;ll see something like this table, just with different entries.</span></p><p class="c0 c4"><span></span></p><p class="c0"><span class="c6">Database: securelab</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">Table: users</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">[1 entry]</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">+---------------+----------------------------------+----+</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">| username &nbsp; &nbsp; &nbsp;| password &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | ID |</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">+---------------+----------------------------------+----+</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">| jeff &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| 166ee015c0e0934a8781e0c86a197c6e | 1 &nbsp;|</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span class="c6">+---------------+----------------------------------+----+</span></p><p class="c0 c4"><span class="c6"></span></p><p class="c0"><span>So, we&rsquo;ve got full information on the usernames and passwords in the database! This is going to be quite useful!</span></p><p class="c0"><span>It looks like these passwords are </span><span class="c3">MD5 </span><span>hashes. &nbsp;If they&rsquo;re not </span><span class="c3">salted</span><span>&nbsp;then it might be easy to look them back up (hint: they&rsquo;re not!). Unfortunately W3AF has no means of cracking MD5 hashes, it can&rsquo;t do everything, although so far it has appeared that it can. &nbsp;Tools that you have seen such as </span><span class="c3">john the ripper</span><span>&nbsp;can when given a word list. &nbsp;Personally, I love the service provided by </span><span class="c7"><a class="c1" href="http://crackstation.net/">http://crackstation.net/</a></span><span>&nbsp;for this, as they&rsquo;ve got a huge MD5 database for fast lookups. &nbsp;Use john, or use crackstation at your own risk.</span></p><p class="c0"><span>By now, you&rsquo;ve noticed that some, but not all, of the passwords have been found. &nbsp;The password for </span><span class="c3">admin</span><span>&nbsp;doesn&rsquo;t seem to have been found, which isn&rsquo;t so great, but at least we&rsquo;ve got some of them, maybe our new permissions will allow us to do some more, and perhaps do more. &nbsp;Try loggin in with one of your new passwords, you should be taken to the members page! Congratulations, you now have access to the site!</span></p><h6 class="c0"><a name="h.fopzoz7r8eaz"></a><span>That should be enough for a gentle introduction to W3AF&rsquo;s sql takeover tools. &nbsp;Continue on for more information and to get more experience with W3AF&rsquo;s tools. The next few sections will have significantly less handholding, so get ready!</span></h6><p class="c0 subtitle"><a name="h.7n4xrw15kyr1"></a><span>Session Jacking - Using the &ldquo;Cookie Jar&rdquo;</span></p><p class="c0"><span>Log in with one of your new found user account/password combinations, and take a look at what cookie was set by the website. &nbsp;Open up the </span><span class="c3">Web Developer Console</span><span>&nbsp;by pressing </span><span class="c3">Ctrl+Shift+K</span><span>&nbsp;from Firefox. &nbsp;Type </span></p><h5 class="c0"><a name="h.9t99lwpn6xb7"></a><span>document.cookie</span></h5><p class="c0"><span>To see what was set. &nbsp;You&rsquo;ll see the cookie details. &nbsp;If we could just find a way to steal </span><span class="c3">admin</span><span>&rsquo;s cookie, and set it as our own, we would be accepted as being </span><span class="c3">admin</span><span>. &nbsp;Wouldn&rsquo;t that be nice? &nbsp;Well, in the next few minutes, I&rsquo;m going to show you how you can do just that. &nbsp;</span></p><p class="c0"><span>When you logged in, surely you noticed the </span><span class="c3">shoutbox</span><span>, no? If you didn&rsquo;t, then check it out! It looks like you can just type things and everyone can see it. &nbsp;Rumor has it that </span><span class="c3">admin</span><span>&nbsp;checks this page quite often. &nbsp;Maybe we can use that to our advantage.</span></p><h6 class="c0"><a name="h.iia5w341y6p2"></a><span>In the case that the </span><span class="c3">shoutbox</span><span>&nbsp;page requires login in order to visit, W3AF can use a </span><span class="c3">cookie jar</span><span>&nbsp;file. &nbsp;In this case, it won&rsquo;t be required, but you can use a Firefox plugin called Cookie Export/Import to help W3AF use your cookies. &nbsp;We&rsquo;ve made it so that you won&rsquo;t need it in this lab due to time constraints.</span></h6><p class="c0"><span>Check out the </span><span class="c3">shoutbox</span><span>&nbsp;page. &nbsp;You can try posting a message. &nbsp;This seems fun, but how can </span><span>you possibly exploit it? &nbsp;Let&rsquo;s go back to W3AF to see if it can figure anything out.</span></p><h6 class="c0"><a name="h.icl4j7sxlos9"></a><span>You can try to make an xss attack without using W3AF, and this case has a simple filter. &nbsp;W3AF can try many things to evade the filter much faster than you can.</span></h6><p class="c0"><span>Now, you can point W3AF at the page </span><span class="c7"><a class="c1" href="http://vulnerable/shout.php">http://vulnerable/shout.php</a></span><span>&nbsp;and turn off any </span><span class="c3">discovery </span><span>plugins. &nbsp;For </span><span>&nbsp;</span><span class="c3">audit </span><span>plugins, this time, we are going to want to use the </span><span class="c3">xss</span><span>&nbsp;plugin, to find </span><span class="c3">cross-site scripting</span><span>&nbsp;vulnerabilities. &nbsp;W3AF should have found a few strings that cause cross site scripting. &nbsp;You can play around with the parameters that it found to do different things. &nbsp;Keep in mind you want to steal the </span><span class="c3">cookies</span><span>&nbsp;of the </span><span class="c3">admin</span><span>&nbsp;user. &nbsp;There are a few ways of accomplishing that, the simplest is getting him to post his cookie back into the shoutbox. &nbsp;This can be accomplished by injecting the javascript code to post cookies back to the shoutbox into your </span><span class="c3">xss</span><span>&nbsp;string. &nbsp;I&rsquo;ll leave that code up to you.</span></p><h6 class="c0"><a name="h.2z2u02kncx9c"></a><span>You can search for </span><span class="c3">javascript post form</span><span>&nbsp;for some examples of how to do this. &nbsp;It is quite simple code! &nbsp;There are other ways, such as getting the victim to submit a post request to a web page that the attacker has prepared. &nbsp;This would require a bit more setup, and we&rsquo;re already running short on time!</span></h6><p class="c0 c4"><span></span></p><p class="c0 subtitle"><a name="h.1yce73tnjr4s"></a><span>Load Cookie - Impersonate Admin</span></p><p class="c0"><span>So, you&rsquo;ve got admin&rsquo;s cookie. &nbsp;Great, but what can you do with it? W3AF can run more scans using that as the </span><span class="c3">cookie jar</span><span>&nbsp;file, but in this particular site, it won&rsquo;t give you any more information, I promise. &nbsp;Just log in to the members page using the cookie to get the satisfaction of breaking into the admin&rsquo;s account! &nbsp;You can search for </span><span class="c3">Edit Cookies Firefox</span><span>&nbsp;to search for the cookie editing plugin to firefox. &nbsp;Chrome has a similar plugin called </span><span class="c3">Edit This Cookie</span><span>&nbsp;which will do the same thing. &nbsp;You&rsquo;re now </span><span class="c3">admin. &nbsp;</span><span>Congratulations, and I hope you&rsquo;ve gotten something out of this lab.</span></p><p class="c0 c4"><span></span></p></body></html>